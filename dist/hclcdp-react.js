"use client";import{Facebook as Pe,GoogleAnalytics as xe}from"hclcdp-web-sdk";import{useEffect as V,useRef as F}from"react";import{createContext as W,useContext as _,useEffect as T,useState as E,useRef as v}from"react";import{HclCdp as c}from"hclcdp-web-sdk";import{createContext as z,useContext as K,useState as m}from"react";import{jsx as Q}from"react/jsx-runtime";var y=z(null),f=({children:e})=>{let[r,n]=m("page"),[i,l]=m({});return Q(y.Provider,{value:{eventIdentifier:r,setEventIdentifier:n,pageProperties:i,setPageProperties:l},children:e})},C=()=>{let e=K(y);if(!e)throw new Error("useCdpContext must be used within a CdpProvider");return e};import{jsx as b}from"react/jsx-runtime";var w=W({isReady:!1,page:function(e){},track:function(e){},identify:function(e){},logout:function(){},setEventIdentifier:()=>{},setPageProperties:()=>{}}),h=({config:e,children:r})=>{let[n,i]=E(!1),[l,I]=E("page"),[j,S]=E({}),R=v(!1),g=v([]),P=v([]),x=v([]);T(()=>{if(!(typeof window>"u")&&!R.current){if(!e.writeKey){console.error("CdpProvider: Missing writeKey");return}c.init(e,(o,p)=>{o?console.error("CDPProvider initialization failed:",o):(R.current=!0,i(!0),g.current.forEach(({identifier:t,properties:s,otherIds:d})=>{c.page(t,s,d)}),g.current=[],P.current.forEach(({identifier:t,properties:s,otherIds:d})=>{c.track(t,s,d)}),P.current=[],x.current.forEach(({identifier:t,properties:s,otherIds:d})=>{c.identify(t,s,d)}),x.current=[])})}},[e.writeKey]);let D=({identifier:o=l,properties:p=j,otherIds:t={}})=>{n?c.page(o,p,t):g.current.push({identifier:o,properties:p,otherIds:t})},H=({identifier:o,properties:p={},otherIds:t={}})=>{n?c.track(o,p,t):P.current.push({identifier:o,properties:p,otherIds:t})},A=({identifier:o,properties:p={},otherIds:t={}})=>{n?c.identify(o,p,t):x.current.push({identifier:o,properties:p,otherIds:t})},N=()=>{n&&c.logout()};return b(f,{children:b(w.Provider,{value:{isReady:n,page:D,track:H,identify:A,logout:N,setEventIdentifier:I,setPageProperties:S},children:r})})},k=()=>_(w);import{jsx as O,jsxs as M}from"react/jsx-runtime";var G=()=>{let{page:e}=k(),{eventIdentifier:r,pageProperties:n}=C(),i=F(!1);return V(()=>{!i.current&&r!=="page"&&(e({identifier:r,properties:n,otherIds:{}}),i.current=!0)},[e,r,n]),null},ce=({config:e,children:r})=>O(h,{config:e,children:M(f,{children:[O(G,{}),r]})});import{useEffect as q}from"react";var Ce=({pageName:e="page",pageProperties:r={}})=>{let{setEventIdentifier:n,setPageProperties:i}=C();return q(()=>{n(e),i(r)},[n,e,i]),null};export{ce as CdpClientWrapper,f as CdpContextProvider,Ce as CdpPageEvent,h as CdpProvider,Pe as Facebook,xe as GoogleAnalytics,k as useCdp,C as useCdpContext};
