"use client";import{Facebook as xe,GoogleAnalytics as Ee}from"hclcdp-web-sdk";import{useEffect as F,useRef as G}from"react";import{createContext as _,useContext as T,useEffect as V,useState as y,useRef as P}from"react";import{HclCdp as c}from"hclcdp-web-sdk";import{createContext as K,useContext as Q,useState as b}from"react";import{jsx as W}from"react/jsx-runtime";var w=K(null),l=({children:e})=>{let[n,r]=b("page"),[s,d]=b({});return W(w.Provider,{value:{eventIdentifier:n,setEventIdentifier:r,pageProperties:s,setPageProperties:d},children:e})},g=()=>{let e=Q(w);if(!e)throw new Error("useCdpContext must be used within a CdpProvider");return e};import{jsx as h}from"react/jsx-runtime";var k=_({isReady:!1,page:function(e){},track:function(e){},identify:function(e){},logout:function(){},setEventIdentifier:()=>{},setPageProperties:()=>{}}),O=({config:e,children:n})=>{let[r,s]=y(!1),[d,u]=y("page"),[f,D]=y({}),m=P(!1),x=P([]),E=P([]),R=P([]);V(()=>{if(!(typeof window>"u")&&!m.current){if(!e.writeKey){console.error("CdpProvider: Missing writeKey");return}c.init(e,(o,i)=>{o?console.error("CDPProvider initialization failed:",o):(m.current=!0,s(!0),x.current.forEach(({identifier:t,properties:p,otherIds:a})=>{c.page(t,p,a)}),x.current=[],E.current.forEach(({identifier:t,properties:p,otherIds:a})=>{c.track(t,p,a)}),E.current=[],R.current.forEach(({identifier:t,properties:p,otherIds:a})=>{c.identify(t,p,a)}),R.current=[])})}},[e.writeKey]);let H=({identifier:o=d,properties:i=f,otherIds:t={}})=>{r?c.page(o,i,t):x.current.push({identifier:o,properties:i,otherIds:t})},A=({identifier:o,properties:i={},otherIds:t={}})=>{r?c.track(o,i,t):E.current.push({identifier:o,properties:i,otherIds:t})},N=({identifier:o,properties:i={},otherIds:t={}})=>{r?c.identify(o,i,t):R.current.push({identifier:o,properties:i,otherIds:t})},z=()=>{r&&c.logout()};return h(l,{children:h(k.Provider,{value:{isReady:r,page:H,track:A,identify:N,logout:z,setEventIdentifier:u,setPageProperties:D},children:n})})},I=()=>T(k);import{jsx as S,jsxs as M}from"react/jsx-runtime";var J=()=>{let{page:e}=I(),{eventIdentifier:n,pageProperties:r}=g(),s=G(!1);return F(()=>{n!=="page"&&(e({identifier:n,properties:r,otherIds:{}}),s.current=!0)},[e,n,r]),null},de=({config:e,children:n})=>S(O,{config:e,children:M(l,{children:[S(J,{}),n]})});import{useEffect as q,useRef as j}from"react";var ve=({pageName:e,pageProperties:n={}})=>{let{setEventIdentifier:r,setPageProperties:s}=g(),d=j(void 0),u=j(void 0);return q(()=>{let f=JSON.stringify(n);d.current!==e&&(r(e||""),d.current=e),u.current!==f&&(s(n),u.current=f)},[e,n,r,s]),null};export{de as CdpClientWrapper,l as CdpContextProvider,ve as CdpPageEvent,O as CdpProvider,xe as Facebook,Ee as GoogleAnalytics,I as useCdp,g as useCdpContext};
