"use client";import{useEffect as M,useRef as q}from"react";import{createContext as A,useContext as T,useEffect as V,useState as E,useRef as v}from"react";import{HclCdp as s}from"hclcdp-web-sdk";import{createContext as K,useContext as Q,useState as m}from"react";import{jsx as W}from"react/jsx-runtime";var R=K(null),C=({children:e})=>{let[n,r]=m("page"),[i,l]=m({});return W(R.Provider,{value:{eventIdentifier:n,setEventIdentifier:r,pageProperties:i,setPageProperties:l},children:e})},f=()=>{let e=Q(R);if(!e)throw new Error("useCdpContext must be used within a CdpProvider");return e};import{jsx as w}from"react/jsx-runtime";var b=A({isReady:!1,page:()=>{},track:()=>{},identify:()=>{},logout:()=>{},setEventIdentifier:()=>{},setPageProperties:()=>{}}),h=({config:e,children:n})=>{let[r,i]=E(!1),[l,O]=E("page"),[j,H]=E({}),y=v(!1),g=v([]),P=v([]),x=v([]);V(()=>{if(!(typeof window>"u")&&!y.current){if(!e.writeKey){console.error("CdpProvider: Missing writeKey");return}s.init(e,(o,p)=>{o?console.error("CDPProvider initialization failed:",o):(y.current=!0,i(!0),g.current.forEach(({identifier:t,properties:d,otherIds:c})=>{s.page(t,d,c)}),g.current=[],P.current.forEach(({identifier:t,properties:d,otherIds:c})=>{s.track(t,d,c)}),P.current=[],x.current.forEach(({identifier:t,properties:d,otherIds:c})=>{s.identify(t,d,c)}),x.current=[])})}},[e.writeKey]);let S=({identifier:o=l,properties:p=j,otherIds:t={}})=>{r?s.page(o,p,t):g.current.push({identifier:o,properties:p,otherIds:t})},N=({identifier:o,properties:p={},otherIds:t={}})=>{r?s.track(o,p,t):P.current.push({identifier:o,properties:p,otherIds:t})},z=({identifier:o,properties:p={},otherIds:t={}})=>{r?s.identify(o,p,t):x.current.push({identifier:o,properties:p,otherIds:t})},D=()=>{r&&s.logout()};return w(C,{children:w(b.Provider,{value:{isReady:r,page:S,track:N,identify:z,logout:D,setEventIdentifier:O,setPageProperties:H},children:n})})},k=()=>T(b);import{jsx as I,jsxs as F}from"react/jsx-runtime";var B=()=>{let{page:e}=k(),{eventIdentifier:n,pageProperties:r}=f(),i=q(!1);return M(()=>{!i.current&&n!=="page"&&(e({identifier:n,properties:r,otherIds:{}}),i.current=!0)},[e,n,r]),null},se=({config:e,children:n})=>I(h,{config:e,children:F(C,{children:[I(B,{}),n]})});import{useEffect as G}from"react";var fe=({pageName:e="page",pageProperties:n={}})=>{let{setEventIdentifier:r,setPageProperties:i}=f();return G(()=>{r(e),i(n)},[r,e,i]),null};export{se as CdpClientWrapper,C as CdpContextProvider,fe as CdpPageEvent,h as CdpProvider,k as useCdp,f as useCdpContext};
